{% extends 'base.html' %}
{% set active_page = 'identity' %}

{% block title %}
  Groups
{% endblock %}

{% block head %}
  <link rel='stylesheet' href='{{ url('/static/css/group.css') }}'>
{% endblock %}

{% block scripts %}
  <script src='{{ url('/static/js/group.js') }}'></script>
{% endblock %}

{% block content %}
  <div class='split-container'>

    <div class=''>

      <div class='header-container'
           data-base-path='{{ url('') }}'
          {#data-group-id='{{ group_row.id }}'#}
      >
        <h1 aria-label>Groups</h1>
      </div>

      <div class='indent'>
        <p>
          Groups allow you to organize access to your data objects efficiently. Instead of granting
          access to individuals one by one, you can add them to a group and manage access
          collectively. Adding a member to a group grants them immediate access to all resources the
          group has access to, while removing them revokes that access.
        </p>
      </div>

    </div>

    {#<div class='indent'>#}
    <div class='split-main'>

      <div class='split-section split-left'>

        <h4>Groups</h4>

        <div class='indent'>
          <p>
            {% if not group_list %}
              You have not created any groups yet.
            {% endif %}
          </p>

          <div class='group-grid'>
            {% for group in group_list %}

              <div>
                <input type="radio"
                       name="group-select"
                       value='{{ group.id }}'
                >
              </div>

              <div class='group-details'>

                <div class=''>
                  <div class='row-center-parent'>
                    {# Edit group name and description #}
                    <button class='icon-button'
                            data-bs-toggle='modal'
                            data-bs-target='#groupModal'
                            data-form-target='{{ url('/ui/api/group/edit') }}'
                            data-title='Edit group'
                            data-group-id='{{ group.id }}'
                            data-group-name='{{ group.name }}'
                            data-group-description='{{ group.description or '' }}'
                            data-submit-text='Save'
                    >
                      <img src='{{ url('/static/svg/edit-pencil.svg') }}' alt='Edit'>
                    </button>
                    {# Name #}
                    <div class='grid-child-title'>{{ group.name }}</div>
                  </div>

                  {# Description #}
                  <div class='grid-child-description'>{{ group.description or '' }}</div>

                  {# Row: Member count, EDI-ID button, Remove button #}
                  <div class='row-center-parent button-row'>
                    {# Member count #}
                    <div>
                        <span class='member-count'>{{ group.member_count }}
                          {% if group.member_count == 1 %}
                            member
                          {% else %}
                            members
                          {% endif %}
                        </span>
                    </div>
                    {# Copy ID #}
                    <div class='edi-id-parent'>
                      <div class='edi-id-child-text'>
                        {{ group.edi_id }}
                      </div>
                      <div class='edi-id-child-icon'>
                        <img src='{{ url('/static/svg/copy.svg') }}'
                             alt='Copy Group Identifier'
                            class='edi-id-copy-button'
                        >
                      </div>
                    </div>
                    {# Remove button #}
                    <div class='row-center-child'>
                      <button class='icon-text-button' data-bs-toggle='modal'
                              data-bs-target='#deleteGroupModal'
                              data-group-id='{{ group.id }}'
                              data-group-name='{{ group.name }}'
                      >
                        <span><img src='{{ url('/static/svg/trash.svg') }}' alt='Unlink'></span>
                        <span>Remove</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

            {% endfor %}
          </div>
          <button type='button' class='btn btn-primary' id='newGroupButton'
                  data-bs-toggle='modal'
                  data-bs-target='#groupModal'
                  data-form-target='{{ url('/ui/api/group/new') }}'
                  data-title='Create a new group'
                  data-group-id=''
                  data-group-name=''
                  data-group-description=''
                  data-submit-text='Add'
          >
            New Group
          </button>
        </div>
      </div>

      <div class='split-section split-right'>
        <div>
          <h4>
            Members
          </h4>
        </div>
        <div>
          <input type='text' class='form-control' id='principalSearch' autocomplete="off"
                 spellcheck="false" placeholder='Select a group in the left panel to update members'
                 disabled
          >
          <div id='principalList' tabindex='0' class='form-control'></div>
        </div>
        <div class='member-grid' id='memberList'>
          {#<div class='grid-msg'>Loading members...</div>#}
        </div>
      </div>
    </div>
  </div>
  {#</div>#}

  {# New/edit group modal #}
  <div class='modal fade' id='groupModal' tabindex='-1' data-bs-backdrop='static'>
    <div class='modal-dialog modal-dialog-centered'>
      <div class='modal-content'>
        <div class='modal-header'>
          <h5 class='modal-title' id='groupTitle'></h5>
          <button type='button' class='btn-close' data-bs-dismiss='modal'
                  aria-label='Close'></button>
        </div>
        <div class='modal-body'>
          <form method='post' id='groupForm' class='needs-validation' novalidate>
            <input type='hidden' id='groupId' name='group-id'>
            <div class='form-group'>
              <p>
                The name and description will help you identify the group later.
              </p>
              <label for='groupName'>Name</label>
              <input type='text' class='form-control' id='groupName' name='name' required
                     pattern='.{3,}'>
              <div class='invalid-feedback'>
                Name must be at least 3 characters long.
              </div>
            </div>
            <div class='form-group'>
              <label for='groupDescription'>Description (optional)</label>
              <input type='text' class='form-control' id='groupDescription' name='description'>
            </div>
            <div class='modal-footer'>
              <button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>Cancel
              </button>
              <button type='submit' class='btn btn-primary' id='groupButton'>Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  {# Delete group modal #}
  <div class='modal fade' id='deleteGroupModal' tabindex='-1' data-bs-backdrop='static'>
    <div class='modal-dialog modal-dialog-centered'>
      <div class='modal-content'>
        <div class='modal-header'>
          <h5 class='modal-title'>Remove Group</h5>
          <button type='button' class='btn-close' data-bs-dismiss='modal'
                  aria-label='Close'></button>
        </div>
        <div class='modal-body'>
          <form action='{{ url('/ui/api/group/delete') }}' method='post' id='deleteGroupForm'>
            <input type='hidden' id='deleteGroupId' name='group-id'>
            <div class='form-group'>
              <p>
                <span>Are you sure you want to remove group </span>
                '<span id='deleteGroupName' class='highlight'></span>'?
                <span>
                </span>
              </p>
              <p>
                <strong>Note:</strong>
                Any access granted by this group to its members will be revoked.
              </p>
            </div>
            <div class='modal-footer'>
              <button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>Cancel
              </button>
              <button type='submit' class='btn btn-danger'>Remove</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

{% endblock %}
