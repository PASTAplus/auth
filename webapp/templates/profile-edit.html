{% extends 'base.html' %}
{% set highlight_menu = 'profile-edit' %}

{% block title %}
  Edit Profile
{% endblock %}

{% block head %}
  <link rel='stylesheet' href='{{ url_buster('/static/css/profile.css') }}'>
{% endblock %}

{% block scripts %}
  <script src='{{ url_buster('/static/js/profile_edit.js') }}'></script>
{% endblock %}

{% block content %}

  <div class='header-container'
       data-highlight-menu='profile-edit'
  >
  </div>

  <div class='indent'>

    <form id='editProfileForm' class='needs-validation' novalidate
          action='{{ url('/ui/api/profile/edit/update') }}' method='post'
    >
      <div class='form-group'>
        <label for='modalName'>Name</label>
        <input type='text' class='form-control' id='modalName' name='common-name'
               required pattern='.{3,}' value='{{ profile.common_name or '' }}' maxlength='64'>
        <div class='invalid-feedback'>
          Please prove a name for the profile.
        </div>
      </div>
      <div class='form-group'>
        <label for='modalEmail'>Email</label>
        <input type='email' class='form-control' id='modalEmail' name='email' value='{{ profile.email or '' }}'>
      </div>
      <div class='form-group'>
        <label for='modalNotifications'>Email notifications</label>
        <input type='checkbox' class='form-check-input' id='modalNotifications'
               name='email-notifications' {{ 'checked' if profile.email_notifications else '' }}>
      </div>
      <div class='form-group'>
        <button type='submit' class='btn btn-primary' id='saveProfileButton'>Save Changes</button>
      </div>
    </form>

  </div>

  <h1 aria-label>Danger Zone</h1>

  <div class='indent'>
    <div class='form-group'>
      <button class='btn btn-danger' data-bs-toggle='modal'
              data-bs-target='#deleteProfileModal'
      >
        <span>Delete Profile</span>
      </button>
    </div>
  </div>

  {# Modal delete profile confirmation dialog #}

  <div class='modal fade' id='deleteProfileModal' tabindex='-1' data-bs-backdrop='static'>
    <div class='modal-dialog modal-dialog-centered'>
      <div class='modal-content'>
        <div class='modal-header'>
          <h5 class='modal-title'>Delete your profile</h5>
          <button type='button' class='btn-close' data-bs-dismiss='modal' aria-label='Close'></button>
        </div>
        <div class='modal-body'>
          <form action='{{ url('/ui/api/profile/edit/delete') }}' method='post' id='deleteProfileForm'>
            <div class='form-group'>
              <p>
                Are you sure you want to delete your profile?
              </p>
              <ul>
                <li>
                  Your profile, will be deleted from the system.
                </li>
                <li>
                  Any linked profiles will be unlinked, but will remain in the system.
                </li>
                <li>
                  The following access will be revoked:
                  <ul>
                    <li>
                      Your access to resources created by you.
                    </li>
                    <li>
                      Your access to resources granted to you by others, both directly and via group
                      memberships.
                    </li>
                    <li>
                      Access you have granted to others.
                    </li>
                    <li>
                      Groups created by you will be removed, and access granted to their members
                      will be revoked.
                    </li>
                  </ul>
                </li>
              </ul>
            </div>
            <div class='form-group'>
              <label for='modalName'>
                Please type 'DELETE' in the box below, then click 'Delete Profile' to confirm that
                you wish to delete your profile. <b>This action cannot be undone</b>.
              </label>
              <input type='text' class='form-control' id='modalName' name='name'
                     required pattern='DELETE' maxlength='64'>
            </div>
            <div class='modal-footer'>
              <button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>Cancel</button>
              <button type='submit' class='btn btn-danger'>Delete Profile</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

{% endblock %}
